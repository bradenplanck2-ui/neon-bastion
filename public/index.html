<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>Neon Prime: Bastion v16.43</title>
<script src="https://cdn.tailwindcss.com"></script>
<link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700&display=swap" rel="stylesheet">
<style>
    body{font-family:'Orbitron',sans-serif;background-color:#050510;color:#ffffff;overflow:hidden;touch-action:none;margin:0;padding:0;user-select:none;-webkit-tap-highlight-color:transparent;width:100vw;height:100dvh}
    canvas{display:block;width:100%;height:100%;background-color:#050510;pointer-events:auto}
    #ui-layer{position:absolute;top:0;left:0;width:100%;height:100%;z-index:20;pointer-events:none}
    .hud-top,.hud-bot,#boss-hud,#ai-comms{text-shadow:0 0 5px currentColor}
    .hud-top{position:absolute;top:0;left:0;width:100%;padding:2vmin;background:linear-gradient(to bottom,rgba(0,0,0,0.9),transparent);display:flex;justify-content:space-between;align-items:flex-start}
    .bars{display:flex;flex-direction:column;gap:0.5vmin;width:20vmin}
    .bar-Fill{height:100%;transition:width 0.1s ease-out;transform-origin:left;will-change:width}
    #hp-bar{height:1.5vmin;background:linear-gradient(to right,#600,#f00);box-shadow:0 0 15px #f00}
    #xp-bar{height:1.5vmin;background:linear-gradient(to right,#050,#0f0);box-shadow:0 0 15px #0f0}
    #od-bar{height:1vmin;background:linear-gradient(to right,#00b0ff,#00e5ff);box-shadow:0 0 15px #0ff;width:0%}
    #boss-hud{position:absolute;top:8vmin;left:50%;transform:translateX(-50%);width:50%;display:none;flex-direction:column;align-items:center}
    .boss-bar-fill{width:100%;height:2vmin;background:#f0f;box-shadow:0 0 15px currentColor;transition:width 0.1s}
    .hud-bot{position:absolute;bottom:2vmin;left:2vmin;pointer-events:none}
    .overlay{position:absolute;top:0;left:0;width:100%;height:100%;background:rgba(5,5,12,0.85);backdrop-filter:blur(4px);display:flex;justify-content:center;align-items:center;z-index:50;pointer-events:auto}
    .hidden{display:none!important}
    .box{background:rgba(16,20,35,0.95);border:2px solid #0ff;box-shadow:0 0 30px rgba(0,255,255,0.2);padding:30px;border-radius:10px;text-align:center;max-width:400px;width:90%;max-height:80vh;overflow-y:auto}
    .btn{background:transparent;border:2px solid #0ff;color:#0ff;padding:12px 30px;font-weight:bold;margin-top:20px;cursor:pointer}
    .action-btn{width:80px;height:80px;border-radius:50%;border:2px solid #fff;background:rgba(0,0,0,0.3);color:#fff;font-weight:bold;display:flex;justify-content:center;align-items:center;text-align:center;pointer-events:auto}
    #mobile-controls{position:absolute;bottom:0;left:0;width:100%;height:100%;pointer-events:none;z-index:30}
    .touch-zone{position:absolute;bottom:0;width:50%;height:60%;pointer-events:auto}
    #left-zone{left:0} #right-zone{right:0;display:flex;flex-direction:column;align-items:flex-end;justify-content:flex-end;padding:20px;gap:20px}
    @media(min-width:1024px){#mobile-controls{display:none}}
</style>
</head>
<body>
<div id="crash-screen" style="display:none;background:black;color:red;padding:20px;position:absolute;z-index:99"><h1>CRASH</h1><div id="crash-log"></div></div>
<canvas id="gameCanvas"></canvas>
<div id="ui-layer">
    <div class="hud-top">
        <div class="text-yellow-400 font-bold text-xl">SCORE: <span id="score">0</span></div>
        <div class="bars"><div class="bg-gray-800"><div id="hp-bar" style="width:100%"></div></div><div class="bg-gray-800"><div id="xp-bar" style="width:0%"></div></div><div class="bg-gray-800 mt-1"><div id="od-bar"></div></div></div>
    </div>
    <div id="boss-hud"><div class="text-purple-400 font-bold" id="boss-name">BOSS</div><div class="w-full bg-gray-900 border border-purple-500"><div id="boss-hp" class="boss-bar-fill"></div></div></div>
    <div class="hud-bot"><div id="ammo-txt" class="text-cyan-400 font-bold text-lg">PLASMA</div><div id="perk-txt" class="text-green-400 text-sm">LVL: 1</div><div id="overdrive-txt" class="text-blue-400 text-sm opacity-50">OD READY (F)</div></div>
    <div id="ai-comms" style="position:absolute;top:15%;right:5%;color:lime;font-size:12px;text-align:right"></div>
</div>
<div id="mobile-controls">
    <div id="left-zone" class="touch-zone"></div>
    <div id="right-zone" class="touch-zone">
        <div class="action-btn" style="border-color:#00e5ff;color:#00e5ff" onclick="triggerOverdrive()">OD<br>(F)</div>
        <div class="action-btn" style="border-color:#ffeb3b;color:#ffeb3b" onclick="triggerRepulsor()">PUSH<br>(SPC)</div>
    </div>
</div>
<div id="menu-main" class="overlay"><div class="box"><h1 class="text-4xl text-cyan-400 font-bold mb-4">NEON BASTION</h1><button class="btn" onclick="startGame()">INITIALIZE</button><button id="btn-load" class="btn hidden" onclick="loadGame()">LOAD GAME</button></div></div>
<div id="menu-upgrade" class="overlay hidden"><div class="box"><h2 class="text-2xl text-green-400">UPGRADE</h2><div id="card-list" class="flex flex-wrap justify-center gap-2 mt-4"></div></div></div>
<div id="menu-over" class="overlay hidden"><div class="box"><h2 class="text-3xl text-red-500">GAME OVER</h2><p class="mt-2">SCORE: <span id="final-score">0</span></p><button class="btn" onclick="location.reload()">RETRY</button></div></div>

<script>
window.onerror=function(m,u,l){document.getElementById('crash-screen').style.display='block';document.getElementById('crash-log').innerText+=`Err:${m} L:${l}\n`};
let canvas,ctx,gameScale=1,state='MENU',frame=0,score=0,wave=1,shake=0;
let player={},bullets=[],enemies=[],powerups=[],stars=[],lasers=[],texts=[],parts=[];
let audioCtx,masterGain,noiseBuffer,droneOsc;
let mouse={x:0,y:0,down:false},joystick={active:false,ox:0,oy:0,cx:0,cy:0,ang:0};
let bossActive=false,aiTimer=0,repulsorCd=0,repulsorAnim=0;

const AMMO={standard:{name:'PLASMA',c:'#0ff',dmg:4.5,spd:1.3,pierce:1,shake:0.3},piercing:{name:'RAILGUN',c:'#f0f',dmg:4,spd:1.6,pierce:5,shake:1},explosive:{name:'FLAK',c:'#fa0',dmg:4,spd:0.9,pierce:0,rad:120,shake:1.5},homing:{name:'SWARM',c:'#0f0',dmg:3.6,spd:1.1,pierce:0,shake:0.4},laser:{name:'BEAM',c:'#f05',dmg:0.1,spd:0,pierce:99,shake:0.1},volt:{name:'VOLT',c:'#ffea00',dmg:3.8,spd:2,pierce:2,shake:0.4}};
const PERKS=[{id:'dmg',name:'Damage',run:p=>p.dmgMult*=1.25},{id:'spd',name:'Speed',run:p=>p.spdMult*=1.3},{id:'rate',name:'Fire Rate',run:p=>p.fireRate*=0.75},{id:'hp',name:'Max HP',run:p=>{p.maxHp+=50;p.hp+=50}},{id:'multi',name:'Multishot',run:p=>p.barrel++}];
const ENEMIES={swarmer:{hp:0.8,spd:1.5,c:'#f44',r:15},tank:{hp:3.5,spd:0.4,c:'#a0f',r:18},boss:{hp:2.0,spd:0.55,c:'#f0f',r:70}};

function init(){
    canvas=document.getElementById('gameCanvas');ctx=canvas.getContext('2d');
    resize();window.addEventListener('resize',resize);
    document.addEventListener('mousedown',e=>{if(state==='PLAY')mouse.down=true;initAudio()});
    document.addEventListener('mouseup',()=>mouse.down=false);
    document.addEventListener('mousemove',e=>{mouse.x=e.clientX;mouse.y=e.clientY});
    const lz=document.getElementById('left-zone');
    lz.addEventListener('touchstart',e=>{e.preventDefault();initAudio();const t=e.changedTouches[0];joystick.active=true;joystick.ox=t.clientX;joystick.oy=t.clientY;mouse.down=true},{passive:false});
    lz.addEventListener('touchmove',e=>{e.preventDefault();if(!joystick.active)return;const t=e.changedTouches[0];const dx=t.clientX-joystick.ox;const dy=t.clientY-joystick.oy;player.angle=Math.atan2(dy,dx)},{passive:false});
    lz.addEventListener('touchend',e=>{e.preventDefault();joystick.active=false;mouse.down=false});
    window.addEventListener('keydown',e=>{if(e.key===' ')triggerRepulsor();if(e.key==='f')triggerOverdrive()});
    resetPlayer(); loop();
}
function resize(){canvas.width=window.innerWidth;canvas.height=window.innerHeight;gameScale=Math.min(canvas.width,canvas.height)/600}
function resetPlayer(){player={x:canvas.width/2,y:canvas.height/2,hp:100,maxHp:100,xp:0,next:60,lvl:1,angle:0,cd:0,ammo:'standard',barrel:1,dmgMult:1,spdMult:1,fireRate:10,od:0,maxOd:100,isOd:false}}
function startGame(){document.getElementById('menu-main').classList.add('hidden');initAudio();state='PLAY';resetPlayer();score=0;wave=1;enemies=[];bullets=[];}
function initAudio(){if(audioCtx)return;audioCtx=new(window.AudioContext||window.webkitAudioContext)();masterGain=audioCtx.createGain();masterGain.connect(audioCtx.destination);masterGain.gain.value=0.3}
function sfx(t){if(!audioCtx)return;const o=audioCtx.createOscillator();const g=audioCtx.createGain();o.connect(g);g.connect(masterGain);o.type=t=='shoot'?'triangle':'square';o.frequency.setValueAtTime(t=='shoot'?300:100,audioCtx.currentTime);g.gain.exponentialRampToValueAtTime(0.01,audioCtx.currentTime+0.1);o.start();o.stop(audioCtx.currentTime+0.1)}
function triggerRepulsor(){if(repulsorCd>0)return;repulsorCd=240;repulsorAnim=30;enemies.forEach(e=>{const d=Math.hypot(e.x-player.x,e.y-player.y);if(d<250){e.x+=(e.x-player.x);e.y+=(e.y-player.y)}})}
function triggerOverdrive(){if(player.od>=100){player.isOd=true;player.od=0;setTimeout(()=>player.isOd=false,5000)}}
function spawnEnemy(){const t=Math.random()<0.1?'tank':'swarmer';const d=ENEMIES[t];let ex=Math.random()*canvas.width,ey=-50;if(Math.random()>.5){ex=-50;ey=Math.random()*canvas.height}enemies.push({type:t,x:ex,y:ey,hp:10*d.hp*wave,max:10*d.hp*wave,s:d.spd,r:d.r,c:d.c})}
function draw(){
    ctx.fillStyle='rgba(5,5,16,0.8)';ctx.fillRect(0,0,canvas.width,canvas.height);
    if(shake>0){ctx.save();ctx.translate(Math.random()*shake,Math.random()*shake);shake*=0.9}
    ctx.fillStyle='#fff';stars.forEach(s=>{ctx.beginPath();ctx.arc(s.x,s.y,s.z,0,7);ctx.fill()});
    bullets.forEach(b=>{ctx.fillStyle=b.c;ctx.beginPath();ctx.arc(b.x,b.y,4*gameScale,0,7);ctx.fill()});
    enemies.forEach(e=>{ctx.strokeStyle=e.c;ctx.lineWidth=3;ctx.beginPath();ctx.arc(e.x,e.y,e.r*gameScale,0,7);ctx.stroke()});
    ctx.save();ctx.translate(player.x,player.y);ctx.rotate(player.angle);ctx.strokeStyle=player.isOd?'#00f':'#0ff';ctx.beginPath();ctx.moveTo(15,0);ctx.lineTo(-10,10);ctx.lineTo(-10,-10);ctx.stroke();ctx.restore();
    if(shake>0)ctx.restore();
    document.getElementById('score').innerText=Math.floor(score);
    document.getElementById('hp-bar').style.width=(player.hp/player.maxHp*100)+'%';
}
function update(){
    if(state!=='PLAY')return;frame++;if(frame%120==0)spawnEnemy();
    if(!joystick.active)player.angle=Math.atan2(mouse.y-player.y,mouse.x-player.x);
    if(player.cd>0)player.cd--;
    if(mouse.down&&player.cd<=0){sfx('shoot');let spd=AMMO[player.ammo].spd*10;bullets.push({x:player.x,y:player.y,vx:Math.cos(player.angle)*spd,vy:Math.sin(player.angle)*spd,c:AMMO[player.ammo].c,life:100});player.cd=player.fireRate;shake=2}
    bullets.forEach((b,i)=>{b.x+=b.vx;b.y+=b.vy;b.life--;if(b.life<0)bullets.splice(i,1)});
    enemies.forEach((e,i)=>{
        let ang=Math.atan2(player.y-e.y,player.x-e.x);e.x+=Math.cos(ang)*e.s;e.y+=Math.sin(ang)*e.s;
        if(Math.hypot(player.x-e.x,player.y-e.y)<e.r+10){player.hp-=1;shake=5;if(player.hp<=0){state='OVER';document.getElementById('menu-over').classList.remove('hidden')}}
        bullets.forEach((b,bi)=>{if(Math.hypot(b.x-e.x,b.y-e.y)<e.r+5){e.hp-=AMMO[player.ammo].dmg;bullets.splice(bi,1);if(e.hp<=0){enemies.splice(i,1);score+=10;player.xp+=10;if(player.xp>=player.next)levelUp()}}});
    });
}
function levelUp(){state='PAUSED';document.getElementById('menu-upgrade').classList.remove('hidden');player.lvl++;player.next*=1.2;player.xp=0;
    const list=document.getElementById('card-list');list.innerHTML='';
    PERKS.slice(0,3).forEach(p=>{const b=document.createElement('div');b.className='btn';b.innerText=p.name;b.onclick=()=>{p.run(player);document.getElementById('menu-upgrade').classList.add('hidden');state='PLAY'};list.appendChild(b)});
}
function loop(){requestAnimationFrame(loop);if(state!=='PAUSED')update();draw()}
window.onload=init;
</script>
</body>
</html>
